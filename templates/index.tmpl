<html>
  <head>
    <meta http-equiv="refresh" content="5" />
    <script type="text/javascript" src="/assets/js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="/assets/js/highcharts.js"></script>
    <title>Pirates Of Tokyo Bay Voting</title>
    <link type="text/css" rel="stylesheet" href="/assets/css/main.css">
    <link rel="shortcut icon" href="/assets/images/fav_icon.png">
  </head>
  <body>
    <h1>{{ .title }}</h1>
    <div class="container" id="mainText">
    </div>

    <script type="text/javascript">

    function rgb2hex(rgb){
     rgb = rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
     return (rgb && rgb.length === 4) ? "#" +
      ("0" + parseInt(rgb[1],10).toString(16)).slice(-2) +
      ("0" + parseInt(rgb[2],10).toString(16)).slice(-2) +
      ("0" + parseInt(rgb[3],10).toString(16)).slice(-2) : '';
    }

    $.ajax({
        url: '/getteams',
        success: function(data) {
            var team1 = data[0];
            var team2 = data[1];
            $(function (data) {
                $('#container').highcharts({
                    tooltip: { enabled: false },
                    credits: {
                        enabled: false
                    },
                    chart: {
                        type: 'column'
                    },
                    title: {
                        text: 'Votes'
                    },
                    xAxis: {
                      gridLineWidth: 0,
                      minorGridLineWidth: 0,
                      title: {text: 'Teams'}
                    },
                    yAxis: {
                        gridLineWidth: 0,
                        minorGridLineWidth: 0,
                        categories: ['# of Votes'],
                        stackLabels: {
                            enabled: true,
                            align: 'center'
                        }
                    },
                    plotOptions: {
                         series: {
                             states: {
                                 hover: {
                                     enabled: false
                                 }
                             }
                         }
                     },
                    series: [{
                        name: team1.Name,
                        data: [team1.Score],
                        color: rgb2hex(team1.Color)
                    }, {
                        name: team2.Name,
                        data: [team2.Score],
                        color: rgb2hex(team2.Color)
                    }]
                });
            });

        },
        error: function() {alert("error occurred.")}
    });

    function clearScores(url) {
      $.post( url, function( data ) {});
      location.reload();
    }

    // Refresh page every 5 seconds
    function loadlink(){
        $('#container').load('/',function () {
             $(this).unwrap();
        });
    }

    loadlink(); // This will run on page load
    </script>
    <div id="container" style="width:100%; height:400px;"></div>
    <button onclick="clearScores('/clearscores')">Clear</button>
  </body>
</html>
